@app.route('/acompanhamento-pessoal')
@login_required
def acompanhamento_pessoal():
    usuario = current_user

    # Pegando o mês atual (ou você pode adaptar para pegar de parâmetro ou sessão)
    mes = datetime.now().strftime('%B').capitalize()

    # Obtenha as mesmas variáveis que você usa na página registrar_producao:
    semanas = obter_semanas_do_mes(mes)  # você pode já ter essa função
    campos = ['averbacao', 'desaverbacao', 'conf_av_desav', 'ctc', 'conf_ctc', 'dtc',
              'conf_dtc', 'in_68', 'dpor', 'registro_atos', 'ag_completar', 'outros']

    # Calcular totais por semana
    totais = {}
    total_feito = 0
    for semana in semanas:
        contagem = {campo: 0 for campo in campos}
        processos = Processo.query.filter_by(usuario_id=usuario.id, semana=semana, mes=mes).all()
        for processo in processos:
            for campo in campos:
                if getattr(processo, campo):
                    contagem[campo] += 1
                    total_feito += 1
        totais[semana] = contagem

    # Meta (se tiver lógica de meta por usuário, substitua aqui)
    meta = 100
    percentual_meta = round((total_feito / meta) * 100, 1) if meta > 0 else 0

    return render_template(
        'acompanhamento_pessoal.html',
        usuario=usuario,
        semanas=semanas,
        totais=totais,
        campos=campos,
        total_feito=total_feito,
        meta=meta,
        percentual_meta=percentual_meta,
        mes=mes
    )
